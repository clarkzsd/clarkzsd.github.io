<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>异步I/O那些事儿 | Clark's Blog</title><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/5.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">异步I/O那些事儿</h1><a id="logo" href="/.">Clark's Blog</a><p class="description"></p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">异步I/O那些事儿</h1><div class="post-meta">Aug 10, 2016<span> | </span><span class="category"><a href="/categories/Tech/">Tech</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><a data-disqus-identifier="2016/08/10/异步IO那些事儿/" href="/2016/08/10/异步IO那些事儿/#disqus_thread" class="disqus-comment-count"></a><div class="post-content"><h2 id="1-什么是回调？"><a href="#1-什么是回调？" class="headerlink" title="1.什么是回调？"></a>1.什么是回调？</h2><blockquote>
<p>你到一个商店买东西，刚好你要的东西没有货，于是你在店员那里留下了你的电话，过了几天店里有货了，店员就打了你的电话，然后你接到电话后就到店里去取了货。在这个例子里，你的电话号码就叫回调函数，你把电话留给店员就叫登记回调函数，店里后来有货了叫做触发了回调关联的事件，店员给你打电话叫做调用回调函数，你到店里去取货叫做响应回调事件。</p>
</blockquote>
<p>From:<a href="https://www.zhihu.com/question/19801131/answer/13005983" target="_blank" rel="external">https://www.zhihu.com/question/19801131/answer/13005983</a><br>以下用代码验证我的理解。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">learn</span>(<span class="params">something</span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(something);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">we</span>(<span class="params">callback, something</span>) </span>&#123;</div><div class="line">    something += <span class="string">' is cool'</span>;</div><div class="line">    callback(something);</div><div class="line">&#125;</div><div class="line"></div><div class="line">we(learn, <span class="string">'Node'</span>); <span class="comment">// Node is cool</span></div></pre></td></tr></table></figure>
<p><a href="http://www.html-js.com/article/Sexy-Javascript-understand-the-callback-function-with-the-use-of-Javascript-in" target="_blank" rel="external">理解与使用回调函数</a></p>
<h2 id="2-什么是同步-异步？"><a href="#2-什么是同步-异步？" class="headerlink" title="2.什么是同步/异步？"></a>2.什么是同步/异步？</h2><h3 id="同步"><a href="#同步" class="headerlink" title="同步"></a>同步</h3><p>一个web页面中，JS代码都是按照标签顺序来执行的。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">// 例1</div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"file.js&gt;&lt;/script&gt;</span></span></div><div class="line">&lt;img src="<span class="attr">image.jpg</span>" /&gt;<span class="actionscript"> <span class="comment">//图片多快出现在你眼前，取决于file.js的装载速度</span></span></div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 例2</span></div><div class="line"><span class="keyword">var</span> c = <span class="number">0</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">printIt</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(c);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">plus</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    c += <span class="number">1</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line">plus();</div><div class="line">printIt(); <span class="comment">// 1</span></div></pre></td></tr></table></figure>
<h3 id="异步"><a href="#异步" class="headerlink" title="异步"></a>异步</h3><blockquote>
<p>异步处理不用阻塞当前线程来等待处理完成，而是允许后续操作，直至其它线程将处理完成，并回调通知此线程。</p>
</blockquote>
<p>举个例子，你和女票今晚想吃小龙虾，就打开手机订外卖，订完就等着外卖小哥打你电话了。外卖小哥打你电话相当于触发回调函数。这个就是<code>异步处理</code>。<br>以下为未进行回调操作的代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> c = <span class="number">0</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">printIt</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(c);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">plus</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        c += <span class="number">1</span>;</div><div class="line">    &#125;, <span class="number">1000</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line">plus();</div><div class="line">printIt(); <span class="comment">// 0</span></div></pre></td></tr></table></figure>
<p>进行回调：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> c = <span class="number">0</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">printIt</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(c);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">plus</span>(<span class="params">callback</span>) </span>&#123;</div><div class="line">    setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        c += <span class="number">1</span>;</div><div class="line">        callback();</div><div class="line">    &#125;, <span class="number">1000</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line">plus(callback); <span class="comment">// 1</span></div></pre></td></tr></table></figure>
<h2 id="3-什么是单线程-多线程？"><a href="#3-什么是单线程-多线程？" class="headerlink" title="3.什么是单线程/多线程？"></a>3.什么是单线程/多线程？</h2><h3 id="单线程"><a href="#单线程" class="headerlink" title="单线程"></a>单线程</h3><p>单线程在程序执行时，所走的程序路径按照连续顺序排下来，前面的必须处理好，后面的才会执行。JavaScript就是单线程的：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> isEnd = <span class="literal">true</span>;</div><div class="line">     <span class="built_in">window</span>.setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">         isEnd = <span class="literal">false</span>;<span class="comment">//1s后，改变isEnd的值</span></div><div class="line">     &#125;, <span class="number">1000</span>);</div><div class="line">     <span class="comment">//这个while永远的占用了js线程，所以setTimeout里面的函数永远不会执行</span></div><div class="line">     <span class="keyword">while</span> (isEnd);</div><div class="line">     <span class="comment">//alert也永远不会弹出</span></div><div class="line">     alert(<span class="string">'end'</span>);</div></pre></td></tr></table></figure>
<h3 id="多线程"><a href="#多线程" class="headerlink" title="多线程"></a>多线程</h3><p>多线程即在同一时间处理多个任务。就像一个人脚踏两条船，在一个时间段交两个女票（？？？？）。<br><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Using_web_workers" target="_blank" rel="external">JavaScript多线程方案——Web worker</a>;</p>
<h2 id="4-什么是阻塞-非阻塞？阻塞-非阻塞与同步-异步的关系。"><a href="#4-什么是阻塞-非阻塞？阻塞-非阻塞与同步-异步的关系。" class="headerlink" title="4.什么是阻塞/非阻塞？阻塞/非阻塞与同步/异步的关系。"></a>4.什么是阻塞/非阻塞？阻塞/非阻塞与同步/异步的关系。</h2><p>还是订外卖的例子：</p>
<ol>
<li>点完菜干等着啥也不干，在门口等菜来了你自己取菜吃。—阻塞、同步</li>
<li>点完菜在家写代码，在门口等菜来了你自己取菜吃。—非阻塞、同步</li>
<li>点完菜干等着啥也不干，等外卖小哥打你电话你出门收菜吃。—阻塞、异步</li>
<li>点完菜在家写代码，等外卖小哥打你电话你出门收菜吃。—非阻塞、异步</li>
</ol>
<h2 id="5-什么是事件循环？"><a href="#5-什么是事件循环？" class="headerlink" title="5.什么是事件循环？"></a>5.什么是事件循环？</h2><blockquote>
<p>主线程从”任务队列”中读取事件，这个过程是循环不断的，所以整个的这种运行机制又称为Event Loop（事件循环）。</p>
</blockquote>
<p><a href="http://www.ruanyifeng.com/blog/2014/10/event-loop.html" target="_blank" rel="external">JavaScript 运行机制详解：再谈Event Loop</a><br><a href="http://web.jobbole.com/83360/" target="_blank" rel="external">JS事件循环详解</a></p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://zhoushidong.cc/2016/08/10/异步IO那些事儿/" data-id="cj17zxrl8000wowgp0nauz1ik" class="article-share-link">分享到</a><div class="tags"><a href="/tags/JavaScript/">JavaScript</a></div><div class="post-nav"><a href="/2016/09/25/一个Express-MVC实例/" class="pre">一个Express MVC实例</a><a href="/2016/07/30/Chrome扩展开发实践——外部数据的获取和存储/" class="next">Chrome扩展开发实践——外部数据的获取和存储</a></div><div id="disqus_thread"><script>var disqus_shortname = 'clarkzsd';
var disqus_identifier = '2016/08/10/异步IO那些事儿/';
var disqus_title = '异步I/O那些事儿';
var disqus_url = 'http://zhoushidong.cc/2016/08/10/异步IO那些事儿/';
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//clarkzsd.disqus.com/count.js" async></script></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://zhoushidong.cc"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Log/">Log</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tech/">Tech</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/♥/">♥</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/言语/">言语</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/流水账/" style="font-size: 15px;">流水账</a> <a href="/tags/css/" style="font-size: 15px;">css</a> <a href="/tags/bootstrap/" style="font-size: 15px;">bootstrap</a> <a href="/tags/chrome/" style="font-size: 15px;">chrome</a> <a href="/tags/JavaScript/" style="font-size: 15px;">JavaScript</a> <a href="/tags/年度总结/" style="font-size: 15px;">年度总结</a> <a href="/tags/windows/" style="font-size: 15px;">windows</a> <a href="/tags/ubuntu/" style="font-size: 15px;">ubuntu</a> <a href="/tags/node-js/" style="font-size: 15px;">node.js</a> <a href="/tags/ife/" style="font-size: 15px;">ife</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/04/07/Log-2017-4-7/">Log:2017-4-7</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/06/Log-2017-4-6/">Log:2017-4-6</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/05/Log-2017-4-5/">Log:2017-4-5</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/02/2017-04-02/">2017年04月02日</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/19/无题-2017年3月19日/">无题 2017年3月19日</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/02/28/自定义checkbox、radio样式/">自定义checkbox、radio样式</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/02/19/JavaScript-函数中的apply-、call-和bind/">JavaScript 函数中的apply()、call()和bind()</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/02/10/关于-JavaScript-作用域/">关于 JavaScript 作用域</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/25/忙/">忙</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/30/my-2016/">my 2016</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-comment-o"> 最近评论</i></div><script type="text/javascript" src="//clarkzsd.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=1&amp;avatar_size=32&amp;excerpt_length=20&amp;hide_mods=1"></script></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://zhizhi.betahouse.us/" title="知之" target="_blank">知之</a><ul></ul><a href="https://blog.hxtao.site/" title="Elliot' Blog" target="_blank">Elliot' Blog</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">Clark's Blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>