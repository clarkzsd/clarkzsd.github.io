<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>关于 JavaScript 作用域 | Clark's Blog</title><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/5.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">关于 JavaScript 作用域</h1><a id="logo" href="/.">Clark's Blog</a><p class="description"></p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">关于 JavaScript 作用域</h1><div class="post-meta">Feb 10, 2017<span> | </span><span class="category"><a href="/categories/Tech/">Tech</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><a data-disqus-identifier="2017/02/10/关于-JavaScript-作用域/" href="/2017/02/10/关于-JavaScript-作用域/#disqus_thread" class="disqus-comment-count"></a><div class="post-content"><p>最近看《JavaScript 语言精粹》时看到这么一句话：</p>
<blockquote>
<p>不像许多其它语言，JavaScript 中的代码块不会创建新的作用域，因此变量应该被定义在函数的头部，而不是在代码块中。</p>
</blockquote>
<p>那么我们就先来看看其它语言 (Java) 的块级作用域是怎么样的</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Test</span> &#123;</div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span>(<span class="params">String[] args</span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span>(<span class="literal">true</span>) &#123;</div><div class="line">      <span class="keyword">int</span> age = <span class="number">3</span>;</div><div class="line">      System.<span class="keyword">out</span>.println(age); <span class="comment">// 3</span></div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    System.<span class="keyword">out</span>.println(age); <span class="comment">// Error</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在这里，age 是 if 这个语句块中的定义的块级变量，其生存周期就是这个语句块，所以在语句块外部访问是无效的。</p>
<p>在 JS 中，对于作用域，又可以分为全局作用域和局部作用域。局部作用域又被称为函数作用域（Function Scope），所有的变量和函数只能在作用域内部使用。</p>
<p>JS 是不支持块级作用域的，在语句块内中定义的变量可以在语句块外访问：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// demo1</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>)</span>&#123;</div><div class="line">  <span class="keyword">if</span>(<span class="literal">true</span>) &#123;</div><div class="line">    <span class="keyword">var</span> age = <span class="number">3</span>;</div><div class="line">  &#125;</div><div class="line">  <span class="built_in">console</span>.log(age); <span class="comment">// 3</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>为什么会出现这样的情况？</p>
<h2 id="提升（hoisting）"><a href="#提升（hoisting）" class="headerlink" title="提升（hoisting）"></a>提升（hoisting）</h2><p>之所以在语句块外能访问，是因为<code>var</code>关键字声明变量时，有一个变量提升的过程：</p>
<blockquote>
<p>Because variable declarations (and declarations in general) are processed before any code is executed, declaring a variable anywhere in the code is equivalent to declaring it at the top. This also means that a variable can appear to be used before it’s declared. This behavior is called “hoisting”, as it appears that the variable declaration is moved to the top of the function or global code.</p>
</blockquote>
<p>而在 demo1 中，函数 test 中 if 语句块里面的 age 变量发生了变量提升，上述代码等价于：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>)</span>&#123;</div><div class="line">  <span class="keyword">var</span> age;</div><div class="line">  <span class="keyword">if</span>(<span class="literal">true</span>) &#123;</div><div class="line">    age = <span class="number">3</span>;</div><div class="line">  &#125;</div><div class="line">  <span class="built_in">console</span>.log(age); <span class="comment">// 3</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这里有一点需要注意：所谓的变量提升只是其定义上升，而变量的赋值是不会上升的。</p>
<p>所以在 JS 中，我们总在作用域的最开始声明变量，这样可以使其作用域变得更加清晰。</p>
<p>同样的，在 JS 中，定义一个 function 时也会发生提升：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">hoisted(); <span class="comment">// logs "foo"</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">hoisted</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">"foo"</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>而函数表达式(Function Expressions)是不会提升的：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">notHoisted(); <span class="comment">// TypeError: notHoisted is not a function</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> notHoisted = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">   <span class="built_in">console</span>.log(<span class="string">"bar"</span>);</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h2 id="let-in-ES6"><a href="#let-in-ES6" class="headerlink" title="let in ES6"></a>let in ES6</h2><p>在ES6中，新增了<code>let</code>关键字，用<code>let</code>声明的变量是存在块级作用域的</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">if</span> (<span class="literal">true</span>) &#123;</div><div class="line">    <span class="keyword">let</span> age = <span class="number">3</span>; </div><div class="line">  &#125; </div><div class="line">  <span class="built_in">console</span>.log(age); <span class="comment">// ReferenceError: age is not defined</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>当我们谈及 JS 的作用域时，肯定会想到闭包、作用域链等概念。而这些知识，且待我学习学习先……</p>
<p>参考：</p>
<ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Glossary/Hoisting" target="_blank" rel="external">Hoisting - Glossary | MDN</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/var" target="_blank" rel="external">var - JavaScript | MDN</a></li>
</ul>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://zhoushidong.cc/2017/02/10/关于-JavaScript-作用域/" data-id="cj955p77n001a8cgp5j2h59hw" class="article-share-link">分享到</a><div class="tags"><a href="/tags/JavaScript/">JavaScript</a></div><div class="post-nav"><a href="/2017/02/19/JavaScript-函数中的apply-、call-和bind/" class="pre">JavaScript 函数中的apply()、call()和bind()</a><a href="/2017/01/25/忙/" class="next">忙</a></div><div id="disqus_thread"><script>var disqus_shortname = 'clarkzsd';
var disqus_identifier = '2017/02/10/关于-JavaScript-作用域/';
var disqus_title = '关于 JavaScript 作用域';
var disqus_url = 'http://zhoushidong.cc/2017/02/10/关于-JavaScript-作用域/';
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//clarkzsd.disqus.com/count.js" async></script></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://zhoushidong.cc"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Log/">Log</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tech/">Tech</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/♥/">♥</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/言语/">言语</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/socket/" style="font-size: 15px;">socket</a> <a href="/tags/流水账/" style="font-size: 15px;">流水账</a> <a href="/tags/电影/" style="font-size: 15px;">电影</a> <a href="/tags/chrome/" style="font-size: 15px;">chrome</a> <a href="/tags/JavaScript/" style="font-size: 15px;">JavaScript</a> <a href="/tags/css/" style="font-size: 15px;">css</a> <a href="/tags/bootstrap/" style="font-size: 15px;">bootstrap</a> <a href="/tags/MongoDB/" style="font-size: 15px;">MongoDB</a> <a href="/tags/读书/" style="font-size: 15px;">读书</a> <a href="/tags/TCP/" style="font-size: 15px;">TCP</a> <a href="/tags/HTTP/" style="font-size: 15px;">HTTP</a> <a href="/tags/年度总结/" style="font-size: 15px;">年度总结</a> <a href="/tags/windows/" style="font-size: 15px;">windows</a> <a href="/tags/ubuntu/" style="font-size: 15px;">ubuntu</a> <a href="/tags/node-js/" style="font-size: 15px;">node.js</a> <a href="/tags/ife/" style="font-size: 15px;">ife</a> <a href="/tags/HTML/" style="font-size: 15px;">HTML</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/10/23/understanding-async-JavaScript/">JavaScript 异步编程一二三</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/29/understanding-JWT/">理解 JWT</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/18/mod-vs-rem/">取模和取余的区别以及 JS 中的取模运算问题</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/04/Cloud-Atlas/">《云图》———今夜我们聊聊人类</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/26/The-First-Encounter-With-Socket/">The First Encounter With Socket</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/23/The-pits-I-met-when-I-use-MongoDB/">The pits I met when I use MongoDB</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/12/Log-2017-4-11/">Log:2017-4-11</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/11/谈谈-meta-标签/">最熟悉的陌生人——<meta> 标签</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/10/Log-2017-4-10/">Log:2017-4-10</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/04/09/Log-2017-4-9/">Log:2017-4-9</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-comment-o"> 最近评论</i></div><script type="text/javascript" src="//clarkzsd.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=1&amp;avatar_size=32&amp;excerpt_length=20&amp;hide_mods=1"></script></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://zhizhi.betahouse.us/" title="知之" target="_blank">知之</a><ul></ul><a href="https://blog.hxtao.site/" title="Elliot' Blog" target="_blank">Elliot' Blog</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">Clark's Blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>